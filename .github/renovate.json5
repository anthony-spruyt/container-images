{
  $schema: "https://docs.renovatebot.com/renovate-schema.json",
  extends: [
    "config:recommended",
    "docker:enableMajor",
    ":dependencyDashboard",
    ":disableRateLimiting",
    ":semanticCommits",
    ":enablePreCommit",
  ],
  enabled: true,
  dependencyDashboardTitle: "Renovate Dashboard",
  suppressNotifications: ["prIgnoreNotification"],
  commitBodyTable: true,
  rebaseWhen: "conflicted",
  // Automerge minor and patch updates when CI passes
  automerge: true,
  automergeType: "pr",
  automergeStrategy: "squash",
  enabledManagers: [
    "custom.regex",
    "dockerfile",
    "github-actions",
    "devcontainer",
    "npm",
  ],
  // Extend devcontainer fileMatch to include custom image assets
  devcontainer: {
    fileMatch: [
      "(^|/)\\.devcontainer\\.json$",
      "(^|/)devcontainer\\.json$",
      "assets/\\.devcontainer\\.json$",
    ],
  },
  // Import custom managers for shell script version annotations
  customManagers: [
    {
      customType: "regex",
      description: ["Process renovate-annotated shell scripts (depName first)."],
      fileMatch: ["\\.sh$"],
      matchStrings: [
        'depName=(?<depName>\\S+) datasource=(?<datasource>\\S+)(?:\\s+versioning=(?<versioning>\\S+))?\\n(?:export\\s+)?[A-Z_]+="(?<currentValue>v?[^"]+)"',
      ],
      datasourceTemplate: "{{#if datasource}}{{{datasource}}}{{else}}github-releases{{/if}}",
      versioningTemplate: "{{#if versioning}}{{{versioning}}}{{else}}semver{{/if}}",
    },
    {
      customType: "regex",
      description: ["Process renovate-annotated shell scripts (datasource first)."],
      fileMatch: ["\\.sh$"],
      matchStrings: [
        'datasource=(?<datasource>\\S+) depName=(?<depName>\\S+)(?:\\s+versioning=(?<versioning>\\S+))?\\n(?:export\\s+)?[A-Z_]+="(?<currentValue>v?[^"]+)"',
      ],
      datasourceTemplate: "{{#if datasource}}{{{datasource}}}{{else}}github-releases{{/if}}",
      versioningTemplate: "{{#if versioning}}{{{versioning}}}{{else}}semver{{/if}}",
    },
  ],
  packageRules: [
    {
      matchDatasources: ["docker"],
      enabled: true,
      commitMessageTopic: "container image {{depName}}",
      commitMessageExtra: "to {{#if isSingleVersion}}v{{{newVersion}}}{{else}}{{{newValue}}}{{/if}}",
    },
    {
      matchDatasources: ["docker"],
      matchUpdateTypes: ["major"],
      labels: ["renovate/image", "dep/major"],
    },
    {
      matchDatasources: ["docker"],
      matchUpdateTypes: ["minor"],
      labels: ["renovate/image", "dep/minor"],
    },
    {
      matchDatasources: ["docker"],
      matchUpdateTypes: ["patch"],
      labels: ["renovate/image", "dep/patch"],
    },
    {
      matchManagers: ["github-actions"],
      labels: ["renovate/github-actions"],
      minimumReleaseAge: "2 days",
    },
    {
      matchManagers: ["custom.regex"],
      labels: ["renovate/script"],
    },
    {
      matchManagers: ["devcontainer"],
      labels: ["renovate/devcontainer"],
    },
    {
      matchManagers: ["npm"],
      labels: ["renovate/npm"],
    },
    // Automerge minor and patch updates
    {
      matchUpdateTypes: ["minor", "patch"],
      automerge: true,
    },
    // Do not automerge major updates
    {
      matchUpdateTypes: ["major"],
      automerge: false,
    },
  ],
}
